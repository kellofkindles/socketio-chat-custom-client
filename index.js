document.innerHTML = '<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>Socket.IO Custom Client</title><link rel="stylesheet" href="style.css"><style>.options{position:absolute;top:0;right:0}.setting{margin:5px 0}</style></head><body><ul class="pages"><li class="chat page"><ul class="options"><li><input type="checkbox" id="ignoreCrash" name="ignoreCrash" class="setting" checked><label for="ignoreCrash">Ignore Crash Messages</label></li><li><input type="checkbox" id="sendTyping" class="setting" name="sendTyping" checked><label for="sendTyping">Send typing message</label></li><li><input type="checkbox" id="antiSpam" class="setting" name="antiSpam"><label for="sendTyping">Anti-spam</label></li><li><input type="checkbox" id="antiLength" class="setting" name="antiLength"> <input id="antiLengthVal" class="setting" name="antiLengthVal" value="100" size="1"><label for="sendTyping">Anti-length</label></li></ul><div class="chatArea"><ul class="messages"></ul></div><input class="inputMessage" placeholder="Type here..."></li><li class="login page"><div class="form"><h3 class="title">What\'s your nickname?</h3><input class="usernameInput"></div></li></ul><script src="https://code.jquery.com/jquery-1.10.2.min.js"></script><script src="/socket.io/socket.io.js"></script><script>var username, lastTypingTime, FADE_TIME = 150, TYPING_TIMER_LENGTH = 400, COLORS = ["#e21400", "#91580f", "#f8a700", "#f78b00", "#58dc00", "#287b00", "#a8f07a", "#4ae8c4", "#3b88eb", "#3824aa", "#a700ff", "#d300e7"], $window = $(window), $usernameInput = $(".usernameInput"), $messages = $(".messages"), $inputMessage = $(".inputMessage"), $loginPage = $(".login.page"), $chatPage = $(".chat.page"), connected = !1, typing = !1, $currentInput = $usernameInput.focus(), socket = io(), addParticipantsMessage = e => { var s = ""; 1 === e.numUsers ? s += "there\'s 1 participant" : s += "there are " + e.numUsers + " participants", log(s) }, setUsername = () => { (username = cleanInput($usernameInput.val().trim())) && ($loginPage.fadeOut(), $chatPage.show(), $loginPage.off("click"), $currentInput = $inputMessage.focus(), socket.emit("add user", username)) }, sendMessage = () => { var e = $inputMessage.val(); (e = cleanInput(e)) && connected && ($inputMessage.val(""), addChatMessage({ username: username, message: e }), socket.emit("new message", e)) }, log = (e, s) => { var a = $("<li>").addClass("log").text(e); addMessageElement(a, s) }, addChatMessage = (e, s) => { if(e.username.charAt(0) === "\uFFFF" && document.getElementById("ignoreCrash").checked){ if(document.getElementById("ignoreCrash").checked){ return; } else{ e.username = "Ignoring crash message"; } } if(e.username.length > document.getElementById("antiLengthVal").value){ e.username = e.username.substr(0,document.getElementById("antiLengthVal").value) + "\u2026" } if(e.message.length > document.getElementById("antiLengthVal").value){ e.message = e.message.substr(0,document.getElementById("antiLengthVal").value) + "\u2026" } var a = getTypingMessages(e); s = s || {}, 0 !== a.length && (s.fade = !1, a.remove()); var n = $(\'<span class="username"/>\').text(e.username).css("color",getUsernameColor(e.username)),t=$(\'<span class="messageBody">\').text(e.message),g=e.typing?"typing":"",o=$(\'<li class="message"/>\').data("username",e.username).addClass(g).append(n,t);addMessageElement(o,s)},addChatTyping=e=>{e.typing=!0,e.message="is typing",addChatMessage(e)},removeChatTyping=e=>{getTypingMessages(e).fadeOut(function(){$(this).remove()})},addMessageElement=(e,s)=>{var a=$(e);s||(s={}),void 0===s.fade&&(s.fade=!0),void 0===s.prepend&&(s.prepend=!1),s.fade&&a.hide().fadeIn(FADE_TIME),s.prepend?$messages.prepend(a):$messages.append(a),$messages.innerHeight()+$messages.scrollTop()>=$messages[0].scrollHeight-100&&($messages[0].scrollTop=$messages[0].scrollHeight)},cleanInput=e=>$("<div/>").text(e).html(),updateTyping=()=>{connected&&(typing||(typing=!0,socket.emit("typing")),lastTypingTime=(new Date).getTime(),setTimeout(()=>{(new Date).getTime()-lastTypingTime>=TYPING_TIMER_LENGTH&&typing&&(socket.emit("stop typing"),typing=!1)},TYPING_TIMER_LENGTH))},getTypingMessages=e=>$(".typing.message").filter(function(s){return $(this).data("username")===e.username}),getUsernameColor=e=>{for(var s=7,a=0;a<e.length&&a<20;a++)s=e.charCodeAt(a)+(s<<5)-s;var n=Math.abs(s%COLORS.length);return COLORS[n]};$window.keydown(e=>{e.ctrlKey||e.metaKey||(document.activeElement.className === "setting")||e.altKey||$currentInput.focus(),13===e.which&&(username?(sendMessage(),socket.emit("stop typing"),typing=!1):setUsername())}),$inputMessage.on("input",()=>{updateTyping()}),$loginPage.click(()=>{$currentInput.focus()}),$inputMessage.click(()=>{$inputMessage.focus()}),socket.on("login",e=>{connected=!0;log("Welcome to Socket.IO Chat â€“ ",{prepend:!0}),addParticipantsMessage(e)}),socket.on("new message",e=>{addChatMessage(e)}),socket.on("user joined",e=>{log(e.username+" joined"),addParticipantsMessage(e)}),socket.on("user left",e=>{log(e.username+" left"),addParticipantsMessage(e),removeChatTyping(e)}),socket.on("typing",e=>{addChatTyping(e)}),socket.on("stop typing",e=>{removeChatTyping(e)}),socket.on("disconnect",()=>{log("you have been disconnected")}),socket.on("reconnect",()=>{log("you have been reconnected"),username&&socket.emit("add user",username)}),socket.on("reconnect_error",()=>{log("attempt to reconnect has failed")});</script></body></html>'
